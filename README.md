## Tables:

Assume we have these table in constraint data scheme with each sale record will have 1 row of data with distinct sale_id and 1 product_id.

### 1. `Sales`
- `sales_id` (INT)
- `customer_id` (INT)
- `product_id` (INT)
- `sale_date` (DATE)
- `quantity` (INT)
- `total_amount` (DECIMAL)

### 2. `Customers`
- `customer_id` (INT)
- `customer_name` (VARCHAR)
- `sales_region` (VARCHAR)
- `sign_up_date` (DATE)

### 3. `Products`
- `product_id` (INT)
- `product_name` (VARCHAR)
- `category` (VARCHAR)
- `price` (DECIMAL)

## Questions and Queries:

### 1. Write a query to return the customer_name, product_name, and total_amount for each sale in the last 30 days.

```sql
SELECT
    c.customer_name AS customer_name, 
    p.product_name AS product_name,
    s.total_amount AS total_amount
FROM
    sales AS s
LEFT JOIN
    customers AS c ON s.customer_id = c.customer_id
LEFT JOIN
    products AS p ON s.product_id = p.product_id
WHERE
    sale_date >= CURRENT_DATE - INTERVAL '30 days';
```

### 2. Write a query to find the total revenue generated by each product category in the last
year. The output should include the product category and the total revenue for that
category.

```sql
SELECT
    p.category AS category,
    SUM(s.total_amount) AS total_revenue
FROM
    products AS p
FULL OUTER JOIN
    sales AS s ON p.product_id = s.product_id
WHERE
    s.sale_date >= CURRENT_DATE - INTERVAL '1 year'
GROUP BY
    p.category;
```

### 3. Write a query to return all customers who made purchases in 2023 and are located in
the &quot;West&quot; region.

```sql
SELECT
    c.customer_name AS customer_name
FROM
    sales AS s
LEFT JOIN
    customers AS c ON s.customer_id = c.customer_id
WHERE
    EXTRACT(YEAR FROM s.sale_date) = 2023
    AND c.sales_region = 'West';
```

### 4. Write a query to display the total number of sales, total quantity sold, and total revenue
for each customer. The result should include the customer_name, total sales, total
quantity, and total revenue.

```sql
SELECT
    c.customer_name AS customer_name,	
    COUNT(s.sales_id) AS total_sales_count,
    SUM(s.quantity) AS total_quantity_sold,
    SUM(s.total_amount) AS total_revenue
FROM
    customers AS c
LEFT JOIN
    sales AS s ON c.customer_id = s.customer_id
GROUP BY
    c.customer_name;
```

### 5. Write a query to find the top 3 customers (by total revenue) in the year 2023.

```sql
SELECT
    c.customer_name AS customer_name,	
    SUM(s.total_amount) AS total_revenue
FROM
    customers AS c
LEFT JOIN
    sales AS s ON c.customer_id = s.customer_id
WHERE
    EXTRACT(YEAR FROM s.sale_date) = 2023
GROUP BY
    c.customer_name
ORDER BY
    total_revenue DESC
LIMIT 3;
```

### 6. Write a query to rank products by their total sales quantity in 2023. The result should
include the product_name, total quantity sold, and rank.

```sql
SELECT
    p.product_name AS product_name,
    SUM(s.quantity) AS total_sale_quantity,
    RANK() OVER (ORDER BY SUM(s.quantity) DESC) AS product_rank
FROM
    products AS p
LEFT JOIN
    sales AS s ON p.product_id = s.product_id
WHERE
    EXTRACT(YEAR FROM s.sale_date) = 2023
GROUP BY
    p.product_name;
```

### 7. Write a query that categorizes customers into &quot;New&quot; (if they signed up in the last 6
months) or &quot;Existing&quot; based on their sign_up_date. Include the customer_name, region,
and category in the result.

```sql
SELECT
    customer_name,
    sales_region AS region,
    CASE 
        WHEN sign_up_date >= (CURRENT_DATE - INTERVAL '6 months') THEN 'New'
        ELSE 'Existing'
    END AS category
FROM
    customers;
```

### 8. Write a query to return the month and year along with the total sales for each month for
the last 12 months.

```sql
SELECT
    EXTRACT(MONTH FROM sale_date) AS sale_month,
    EXTRACT(YEAR FROM sale_date) AS sale_year,
    SUM(total_amount) AS total_sales
FROM
    sales
WHERE
    sale_date >= CURRENT_DATE - INTERVAL '12 months'
GROUP BY
    EXTRACT(MONTH FROM sale_date), EXTRACT(YEAR FROM sale_date);
```

### 9. Write a query to return the product categories that generated more than $50,000 in
revenue during the last 6 months.

```sql
SELECT
    p.category AS product_category,
    SUM(s.total_amount) AS total_revenue
FROM
    products AS p
JOIN
    sales AS s ON p.product_id = s.product_id
WHERE
    s.sale_date >= CURRENT_DATE - INTERVAL '6 months'
GROUP BY
    p.category
HAVING
    SUM(s.total_amount) >= 50000;
```

### 10. Write a query to check for any sales where the total_amount doesnâ€™t match the expected
value (i.e., quantity * price).

```sql
SELECT
    s.sale_id AS sale_id,
    s.quantity AS quantity,
    p.price AS price,
    s.total_amount AS total_amount,
    (s.quantity * p.price) AS expected_total
FROM
    sales AS s
LEFT JOIN
    products AS p ON s.product_id = p.product_id
WHERE
    s.total_amount != (s.quantity * p.price);
```

### Conclusion
This document contains the SQL queries required for the test. Each query addresses the specified questions and makes use of common SQL operations such as `JOIN`, `GROUP BY`, `ORDER BY`, and `HAVING` clauses.
